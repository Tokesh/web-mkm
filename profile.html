<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Home / X</title>
    <link rel="stylesheet" href="css/home.css">
</head>

<body>
    <section>
        <!-- Это левая панелька -->
        <div class="main-left-bar">
            <div class="main-left-bar-1">
                <ul>
                    <li><a href="home.html"><img src="images/x-logo.png" alt="x-logo" width="30px"></a></li>
                    <li><a href="home.html"><img src="images/home.png" alt="home" width="30px">Home</a></li>
                    <li><a href="explore.html"><img src="images/find.png" alt="explore" width="30px">Explore</a></li>
                    <li><a href="notifications.html"><img src="images/notifications.png" alt="notifications" width="30px">Notifications</a></li>
                    <li><a href="messages.html"><img src="images/messages.png" alt="messages" width="30px">Messages</a></li>
                    <li><a href="lists.html"><img src="images/lists.png" alt="lists" width="30px">Lists</a></li>
                    <li><a href="communities.html"><img src="images/communities.png" alt="communities" width="30px">Communities</a></li>
                    <li><a href="#"><img src="images/x.png" alt="premium" width="30px">Premium</a></li>
                    <li><a href="profile.html"><img src="images/profile.png" alt="profile" width="30px">Profile</a></li>
                    <li><a href="#"><img src="images/more.png" alt="more" width="30px">More</a></li>
                </ul>
                <button style="background: dodgerblue;height: 50px;width: 100%;border: none;font-size: 20px;color: white;font-weight: bold;border-radius: 30px;">Post</button>
            </div>
            <div class="main-left-bar-2">
                <img src="images/avatar.jpg" alt="avatar" width="50px" style="border-radius: 50px;">
                <div class="main-left-bar-2-text">
                    <h3 style="color: white">Kan</h4>
                    <h4 style="color: grey">@Kanres</h4>
                </div>
            </div>
        </div>


        <div class="main-middle-content">
            <div class="profile-container">
                <a href="home.html"><img src="./images/arrow-left.png" alt="x-logo" width="30px"></a>
                <div class="profile-info">
                    <h1 style="color: white">Kan</h1>
                    <h4 style="color: rgb(100, 100, 102)">0 posts</h4>
                </div>
            </div>
            <div class="user-profile">
                <div class="background"></div>
                    <div class="user-info" style="margin-left:20px">
                        <img src="images/avatar.jpg" alt="avatar" width="150px" style="border-radius: 50%;">
                        <h2>Kan</h2>
                        <h4 style="color: grey">@Kanres</h4>
                        <h4 style="color: grey">Joined November 2022</h4>
                        <div style="display:flex; gap:5px">
                            <h4 style="color: white;">5</h4><h4 style="color: grey; margin-bottom: 10px; margin-right: 10px;">Following</h4>
                            <h4 style="color: white;">0</h4><h4 style="color: grey; margin-bottom: 10px;">Followers</h4>
                        </div>
                    </div>
                <div class="container">
                    <div class="navigation">
                        <button class="nav-button active" onclick="changeTab('posts')">Posts</button>
                        <button class="nav-button" onclick="changeTab('replies')">Replies</button>
                        <button class="nav-button" onclick="changeTab('highlights')">Highlights</button>
                        <button class="nav-button" onclick="changeTab('media')">Media</button>
                        <button class="nav-button" onclick="changeTab('likes')">Likes</button>
                    </div>
                </div>
                <div class="posts-container">

                </div>
                <script>
                    fetch('profile_posts.php')
                        .then(response => response.json())
                        .then(data => {
                            console.log(data);
                            data.forEach(post => {
                                const postDiv = document.createElement('div');
                                postDiv.innerHTML = `
                                <div class="post" style="padding:20px;">
                                <div class="post-left">
                                    <img src="images/avatar.jpg" alt="pfp" style="width: 40px;height: 40px;border-radius: 30px;">
                                </div>
                                <!-- Это правая часть -->
                                <div class="post-right">
                                    <!-- Это часть с контентом -->
                                    <div class="post-content">
                                        <!-- Тут имя пользователя и его ник -->
                                        <div class="post-username">
                                            <p style="color: gray;font-weight: 100;"><b style="color: white;">${post.username}</b> @${post.username}</p>
                                        </div>
                                        <!-- Это сам контент (тут пока только текст) -->
                                        <div class="post-content-text">
                                            <p style="color: rgb(217, 217, 217);font-family:Verdana, Geneva, Tahoma, sans-serif;font-size: 14px;">${post.title}</p>
                                        </div>
                                    </div>
                                    <!-- Это часть с иконками -->
                                    <div class="post-bottom">
                                        <!-- Тут тоже делится на 2 части -->
                                        <div class="post-bottom-left">
                                            <!-- Каждая иконка это отдельный класс с картинкой и числом. -->
                                            <div class="post-bottom-left-item">
                                                <img src="images/comment.png" width="20px" alt="comment" style="opacity: 50%;filter: invert(1);cursor: pointer;">
                                                <p style="color: grey;font-size: 12px;">${post.retweets_number}</p>
                                            </div>
                                            <div class="post-bottom-left-item">
                                                <img src="images/retweet.png" width="20px" alt="retweet" style="opacity: 50%;filter: invert(1);cursor: pointer;">
                                                <p style="color: grey;font-size: 12px;">12</p>
                                            </div>
                                            <div class="post-bottom-left-item">
                                                <img src="images/like.png" width="20px" alt="like" style="opacity: 50%;filter: invert(1);cursor: pointer;">
                                                <p style="color: grey;font-size: 12px;">${post.likes_number}</p>
                                            </div>
                                            <div class="post-bottom-left-item">
                                                <img src="images/view.png" width="20px" alt="view" style="opacity: 50%;filter: invert(1);cursor: pointer;">
                                                <p style="color: grey;font-size: 12px;">${post.likes_number + post.retweets_number}</p>
                                            </div>
                                        </div>
                                        <!-- В этой части тоже иконки. Тут кнопки сохранения и "поделиться" -->
                                        <div class="post-bottom-right">
                                            <div class="post-bottom-right-item">
                                                <img src="images/bookmark.png" width="20px" alt="bookmark" style="opacity: 50%;filter: invert(1);cursor: pointer;">
                                            </div>
                                            <div class="post-bottom-right-item">
                                                <img src="images/share.png" width="20px" alt="share" style="opacity: 50%;filter: invert(1);cursor: pointer;">
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                                `;
                                
                                const topBar = document.querySelector('.profile-info h4');
                                    // Update HTML content with user information
                                topBar.textContent = `${data.length} posts`;
                                // Append the postDiv to an existing container in your HTML
                                const postsContainer = document.querySelector('.posts-container'); // Change this selector to match your container
                                postsContainer.appendChild(postDiv);
                            });
                        })
                        .catch(error => console.error('Error:', error));
                </script>
                
                <h1 style="color:white; padding:20px"> Who to follow</h1>
                <div class="who-to-follow">
                    <script>
                        // Fetch user data from the PHP script using the fetch API
                        fetch('get_user_info.php')
                            .then(response => response.json())
                            .then(user => {
                                if (user) {
                                    // Get the elements where user data will be displayed
                                    const userNameElement = document.querySelector('.user-info h2');
                                    const userUsernameElement = document.querySelector('.user-info h4');
                                    const topUsernameElement = document.querySelector('.profile-info h1');
                                    
                                    const leftTopUsernameElement = document.querySelector('.main-left-bar-2-text h3');
                                    const leftBotnameElement = document.querySelector('.main-left-bar-2-text h4');
                                    // Update HTML content with user information
                                    userNameElement.textContent = user.firstname + ' ' + user.lastname;
                                    userUsernameElement.textContent = `@${user.username}`;
                                    topUsernameElement.textContent = `${user.username}`;
                                    leftTopUsernameElement.textContent = `${user.username}`;
                                    leftBotnameElement.textContent = `@${user.username}`;
                                    userNameElement.style.color = 'white';
                                }
                            })
                            .catch(error => console.error('Error:', error));
                    </script>
                    
                    <script>
                        // Fetch user data from PHP script using fetch API
                        fetch('get_users.php')
                            .then(response => response.json())
                            .then(data => {
                                // Get the container where user data will be displayed
                                const whoToFollow = document.querySelector('.who-to-follow');
                
                                // Iterate through the user data and create HTML elements
                                data.forEach(user => {
                                    const userDiv = document.createElement('div');
                                    userDiv.innerHTML = `
                            <div class="post" style="margin-top: 20px;margin-bottom:20px; display: flex; justify-content: space-between; align-items: center;">
                                <div class="post-left" style="display:flex;justify-content:left;">
                                    <img src="${user.img}" alt="${user.name}" style="width: 40px; height: 40px; border-radius: 30px;">
                                    
                                    <div class="post-content" style="margin-left: 10px;">
                                        <!-- Тут имя пользователя и его ник -->
                                        <div class="post-username">
                                            <p style="color: gray; font-weight: 100;"><b style="color: white;">${user.username}</b> @${user.username}</p>
                                        </div>
                                        <div class="post-content-text">
                                            <p style="color: rgb(217, 217, 217);font-family:Verdana, Geneva, Tahoma, sans-serif;font-size: 14px;">${user.description}</p>
                                        </div>
                                    </div>
                                </div>
                                <!-- Это правая часть -->
                                <div class="post-right" style="display: flex; flex-direction: row; align-items: center;">            
                                    <button style="background: dodgerblue;margin-right:20px; height: 30px; width: 5vw; border: none; font-size: 16px; color: white; font-weight: bold; border-radius: 30px; cursor: pointer;" onclick="subscribe(${user.user_id})">Follow</button>
                            
                                </div>
                            </div>
                                        
                                    `;
                                    
                                    // Append the user's data to the container
                                    whoToFollow.appendChild(userDiv);
                                });
                            })
                            .catch(error => console.error('Error:', error));
                        function subscribe(userId) {
                            
                            fetch('subscribe.php', {
                                method: 'POST',
                                body: JSON.stringify({ userId }), // Отправляем id пользователя на сервер
                                headers: {
                                    'Content-Type': 'application/json'
                                }
                            })
                            .then(response => response.json())
                            .then(data => {
                                if (data.success) {
                                    alert('Вы успешно подписались на пользователя!');
                                    const button = document.querySelector(`button[data-userid="${userId}"]`);
                                    if (button) {
                                        button.textContent = 'Отписаться';
                                        button.removeEventListener('click', subscribe);
                                        button.addEventListener('click', unsubscribe);
                                    }
                                } else {
                                    alert('Произошла ошибка при подписке. Попробуйте еще раз.');
                                    // Здесь можно обработать случай ошибки при подписке
                                }
                            })
                            .catch(error => console.error('Error:', error));
                        }
                        function unsubscribe(userId) {
                            const button = document.querySelector(`button[data-userid="${userId}"]`);
                            if (button) {
                                button.textContent = 'Подписаться';
                                button.removeEventListener('click', unsubscribe);
                                button.addEventListener('click', subscribe);
                            }
                        }

                    </script>
            </div>
                
            </div>
        </div>
        <div class="main-right-bar" style="justify-content:initial;">
            <div class="main-right-bar-search">
                <a href="results_page.html" id="searchLink">
                    <img src="images/find.png" alt="search" width="24px" height="24px">
                </a>
                <input type="text" id="searchInput" placeholder="Search" style="border: none; background: rgb(47, 47, 47); height: 40px; font-size: 16px; border-radius: 50px; width: 100%; color: white;">
                <script>
                    // Получаем ссылку и поле ввода по их id
                    const searchLink = document.getElementById('searchLink');
                    const searchInput = document.getElementById('searchInput');
                
                    // При клике на картинку
                    searchLink.addEventListener('click', function () {
                        // Получаем значение из поля ввода
                        const searchText = searchInput.value;
                
                        // Сохраняем значение в localStorage
                        localStorage.setItem('searchQuery', searchText);
                    });
                
                    // При загрузке страницы
                    window.addEventListener('load', function () {
                        // Получаем значение из localStorage
                        const savedSearchQuery = localStorage.getItem('searchQuery');
                
                        // Если значение найдено, устанавливаем его в поле ввода
                        if (savedSearchQuery) {
                            searchInput.value = savedSearchQuery;
                        }
                    });
                </script>
            </div>            
            <div class="main-right-bar-premium">
                <h2 style="color: white;">Subscribe to Premium</h2>
                <h4 style="color: white;">Subscribe to unlock new features and if eligible, receive a share of ads revenue.</h4>
                <a href="premium.html" style="width: 7vw;"><button style="background: dodgerblue;height: 30px;width: 7vw;border: none;font-size: 16px;color: white;font-weight: bold;border-radius: 30px;cursor: pointer;;">Subscribe</button></a>
            </div>

            <div class="trending">
                <h1 style="color: white;padding: 1vw 0 0 1vw;">Trends for you</h1>
                <div class="trends-box">
                    <div class="trends-item">
                        <p style="color: gray;font-size: 14px;">News • Trending</p>
                        <h4 style="color: white;">Hamas</h4>
                        <p style="color: grey;font-size: 14px;">2.72M posts</p>
                    </div>

                    <div class="trends-item">
                        <p style="color: gray;font-size: 14px;">Only on Twitter • Trending</p>
                        <h4 style="color: white;">#TheAmazingDigitalCircus</h4>
                        <p style="color: grey;font-size: 14px;">119K posts</p>
                    </div>

                    <div class="trends-item">
                        <p style="color: gray;font-size: 14px;">News • Trending</p>
                        <h4 style="color: white;">Israel</h4>
                        <p style="color: grey;font-size: 14px;">6.96M posts</p>
                    </div>

                    <div class="trends-item">
                        <p style="color: gray;font-size: 14px;">Trending in Kazakhstan</p>
                        <h4 style="color: white;">Ризли</h4>
                    </div>

                    <div class="trends-item">
                        <p style="color: gray;font-size: 14px;">Trending in Kazakhstan</p>
                        <h4 style="color: white;">China</h4>
                        <p style="color: grey;font-size: 14px;">358K posts</p>
                    </div>

                    <div class="trends-item">
                        <a href="#" style="color: dodgerblue;font-size: 16px;font-weight: bold;">Show more</a>
                    </div>
                </div>
            </div>
    </section>
</body>
</html>